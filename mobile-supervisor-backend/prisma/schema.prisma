generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model admin {
  id        String     @id @default(uuid())
  username  String  @unique
  password  String  
  createdAt DateTime @default(now())
}

model users {
  id           String   @id @default(uuid())
  full_name    String
  address      String?
  email        String   @unique
  citizen_id   String   @unique
  created_at   DateTime @default(now())
  devices devices[]
}

model devices {
  id            String   @id @default(uuid())
  api_key       String   @unique
  user_id       String
  phone_number  String   @unique
  model         String?
  type          String?
  device_os     String?
  last_seen     DateTime?
  registered_at DateTime @default(now())

  user               users              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  location_history   location_history[]
  cell_tower_history cell_tower_history[]
}

model location_history {
  id          String   @id @default(uuid())
  device_id   String
  latitude    Decimal  @db.Decimal(10, 8)
  longitude   Decimal  @db.Decimal(11, 8)
  recorded_at DateTime

  device devices @relation(fields: [device_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model cell_tower_history {
  id          String   @id @default(uuid())
  device_id   String
  mcc         Int?
  mnc         Int?
  lac         Int?
  cid         Int?
  pci         Int?
  type        String?
  is_serving  Boolean  @default(false)
  rssi        Int?
  signal_dbm  Int?
  recorded_at DateTime

  device devices @relation(fields: [device_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

// Thêm model này vào schema.prisma

model bts_stations {
  id        Int      @id @default(autoincrement())
  mcc       Int
  mnc       Int
  lac       Int
  cid       Int
  
  // Tọa độ của trạm BTS
  lat       Decimal  @db.Decimal(10, 8)
  lon       Decimal  @db.Decimal(11, 8)
  
  radio     String?  // Loại mạng: GSM, LTE, UMTS (3G)
  range     Int?     // Bán kính phủ sóng ước tính (mét)
  address   String?  // Địa chỉ ước lượng (nếu có)
  
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Quan trọng: Tạo khóa unique để tránh lưu trùng lặp trạm
  @@unique([mcc, mnc, lac, cid], name: "unique_cell_id")
  
  // Index để query nhanh hơn
  @@index([mcc, mnc, lac, cid])
}
